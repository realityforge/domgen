/* DO NOT EDIT: File is auto-generated */
package <%= to_package(repository.gwt_rpc.qualified_rpc_request_builder_name) %>;

@javax.annotation.Generated( "Domgen" )
@java.lang.SuppressWarnings( { "UnusedDeclaration", "JavaDoc" } )
public class <%= repository.gwt_rpc.rpc_request_builder_name %>
  extends com.google.gwt.user.client.rpc.RpcRequestBuilder
{
  @javax.annotation.Nonnull
  private final String _baseUrl;
  @javax.annotation.Nonnull
  private final org.realityforge.gwt.keycloak.Keycloak _keycloak;

  public <%= repository.gwt_rpc.rpc_request_builder_name %>( @javax.annotation.Nonnull final String baseUrl, @javax.annotation.Nonnull final org.realityforge.gwt.keycloak.Keycloak keycloak )
  {
    _baseUrl = java.util.Objects.requireNonNull( baseUrl );
    _keycloak = java.util.Objects.requireNonNull( keycloak );
  }

  @Override
  protected void doFinish( final com.google.gwt.http.client.RequestBuilder rb )
  {
    super.doFinish( rb );
    final String token = _keycloak.getToken();
    if( null == token )
    {
      throw new IllegalStateException( "Missing token" );
    }
    else
    {
      rb.setHeader( "Authorization", "Bearer " + _keycloak.getToken() );
      rb.setHeader( MODULE_BASE_HEADER, _baseUrl );
    }
  }
}
